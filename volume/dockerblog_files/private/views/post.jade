extends blog
	
block content

	#div.post
	
		#div.block.title
			h2
				a(href="/" + post.slug +  "/" + post.ID) #{post.title}
					
			.date(style="float:right;") #{post.stringdate}
			.clearboth
			
		- each block,i in post.blocks
			if (block.type == "text")
				.block.text
					p !{block.text}

			else if (block.type == "image")
				.block_img.image
					if (block.url != "")
							a(href=block.url)
								if (block.description && block.description != "")
									img(src=block.path alt="#{block.description}")
								else
									img(src=block.path)
						else
							if (block.description && block.description != "")
								img(src=block.path alt="#{block.description}")
							else
								img(src=block.path)
						
			else if (block.type == "contact")
					#div.block.contact
						.tinyForm(id="contactForm_" + post.ID + "_" + i)
							div(id="formsending_" + post.ID + "_" + i style="display: none")
								p Sending message...
							div(id="formsent_" + post.ID + "_" + i style="display: none")
								p Message sent! I'll answer as soon as I can!
							div(id="formerror_" + post.ID + "_" + i style="display: none")
								p Error when sending message!
								
							div(id="contactFields_"+post.ID+"_"+i)
								input.mandatory(id="contactEmail_"+post.ID+"_"+i type="text" value="Your email" 
								onfocus="if(this.value == 'Your email') { this.value = ''; } backToOriginalBackground(this);" 
								onblur="if(this.value == '') { this.value = 'Your email'; }")
								input.optional(id="contactSubject_"+post.ID+"_"+i type="text" value="Subject"
								onfocus="if(this.value == 'Subject') { this.value = ''; } backToOriginalBackground(this);"
								onblur="if(this.value == '') { this.value = 'Subject'; }")
								textarea.mandatory(id="contactContent_"+post.ID+"_"+i
								onfocus="backToOriginalBackground(this);")
								input(type="button" value="Send" onclick="sendMessage(#{post.ID},#{i},'Your email','Subject')")

		a(name="coms")
		#comments
			- if (comments.length == 0)
				h2 #{keys.loc_no_comments}
			- else if (comments.length == 1)
				h2 #{comments.length} #{keys.loc_comment}
			- else
				h2 #{comments.length} #{keys.loc_comments}
			
			
			- each comment in comments

				a(name="com#{comment.ID}")

				- var widthPercentage = (10 - comment.indent) * 10
				- if (widthPercentage < 70) widthPercentage = 70

				- if (comment.name == "Laurel" && (comment.email == "secret@bloglaurel.com" || comment.email == "laurelcomix@gmail.com"))
					.comment(style="width:#{widthPercentage}%;background-color:#dde5ea;" id="com_#{comment.ID}")
						img.gravatar(style="margin-right:15px;" src="http://www.gravatar.com/avatar/#{comment.gravatar}?s=81")

						.date
							p #{comment.date}
							
						.text
							h2
								if (comment.website)
									|  <a href="#{comment.website}">#{comment.name}</a>
								else
									| #{comment.name}

								if (comment.twitter && comment.twitter != "twitter")
									|  - <a href="https://twitter.com/#{comment.twitter}">@#{comment.twitter}</a>

							p !{comment.content.replace(/\n/g, '<br/>')}
							
						.clearboth
						.answer
							a(href="#" onclick="answerComment(#{comment.ID});return false;") #{keys.loc_answer}
						.clearboth
					.clearboth
					div(id="com_end_#{comment.ID}")
					
				- else if (comment.name == "Ad" && comment.email == "adrien@duermael.com")
					.comment(style="width:#{widthPercentage}%;background-color:#f3e8f0;" id="com_#{comment.ID}")
						img.gravatar(style="margin-right:15px;" src="http://www.gravatar.com/avatar/#{comment.gravatar}?s=81")

						.date
							p #{comment.date}
							
						.text
							h2 
								if (comment.website)
									|  <a href="#{comment.website}">#{comment.name}</a>
								else
									| #{comment.name}

								if (comment.twitter && comment.twitter != "twitter")
									|  - <a href="https://twitter.com/#{comment.twitter}">@#{comment.twitter}</a>


							p !{comment.content.replace(/\n/g, '<br/>')}
							
						.clearboth
						.answer
							a(href="#" onclick="answerComment(#{comment.ID});return false;") #{keys.loc_answer}
						.clearboth
					.clearboth
					div(id="com_end_#{comment.ID}")
					
				- else
					.comment(style="width:#{widthPercentage}%;" id="com_#{comment.ID}")
						img.gravatar(style="margin-right:15px;" src="http://www.gravatar.com/avatar/#{comment.gravatar}?s=81")

						.date
							p #{comment.date}
							
						.text
							h2 
								if (comment.website)
									|  <a href="#{comment.website}">#{comment.name}</a>
								else
									| #{comment.name}

								if (comment.twitter && comment.twitter != "twitter")
									|  - <a href="https://twitter.com/#{comment.twitter}">@#{comment.twitter}</a>

							p !{comment.content.replace(/\n/g, '<br/>')}
							
						.clearboth
						.answer
							a(href="#" onclick="answerComment(#{comment.ID});return false;") #{keys.loc_answer}
						.clearboth
					.clearboth
					div(id="com_end_#{comment.ID}")
			
			#form
				#formsending(style="display: none")
					p #{keys.loc_comment_sending}
				#formsent(style="display: none")
					p #{keys.loc_comment_sent}
				#formerror(style="display: none")
					p #{keys.loc_comment_send_error}
				
					
				#fields
					input#answerComID(type="hidden" value=-1)
					input#postID(type="hidden" value=post.ID)
					
					.user
						
						- if (commentGravatar)
							img#formGravatar.gravatar(src="http://www.gravatar.com/avatar/#{commentGravatar}?s=81")
						- else
							img#formGravatar.gravatar(src="http://www.gravatar.com/avatar/nogravatar?s=81")
							
						//- var test = Math.sqrt(16);

						- if (commentName)
							input#commentName.mandatory(style="margin-bottom:5px;" type="text" value="#{commentName}" onfocus="if(this.value == 'name') { this.value = ''; } backToOriginalBackground(this);" 
							onblur="if(this.value == '') { this.value = 'name'; }")
						- else
							input#commentName.mandatory(style="margin-bottom:5px;" type="text" value="name" onfocus="if(this.value == 'name') { this.value = ''; } backToOriginalBackground(this);"
							onblur="if(this.value == '') { this.value = 'name'; }")
													
						- if (commentEmail)
							input#commentEmail.optional(type="text" value="#{commentEmail}" onkeyup="emailChange(this);" onfocus="if(this.value == 'email') { this.value = ''; } backToOriginalBackground(this);"
							onblur="if(this.value == '') { this.value = 'email'; }")
						- else
							input#commentEmail.optional(type="text" value="email" onkeyup="emailChange(this);" onfocus="if(this.value == 'email') { this.value = ''; } backToOriginalBackground(this);"
							onblur="if(this.value == '') { this.value = 'email'; }")

					- if (!commentGravatar)
						.user_gravatar_info
							p
								| Associez votre email Ã  une image <a href="http://gravatar.com">Gravatar</a>!

					.user_web

						- if (commentWebsite)
							input#commentWebsite.optional(type="text" value="#{commentWebsite}" onfocus="if(this.value == 'website') { this.value = ''; } backToOriginalBackground(this);"
							onblur="if(this.value == '') { this.value = 'website'; }")
						- else
							input#commentWebsite.optional(type="text" value="website" onfocus="if(this.value == 'website') { this.value = ''; } backToOriginalBackground(this);"
							onblur="if(this.value == '') { this.value = 'website'; }")


						- if (commentTwitter)
							input#commentTwitter.optional(style="float:right" type="text" value="#{commentTwitter}" onfocus="if(this.value == 'twitter') { this.value = ''; } backToOriginalBackground(this);"
							onblur="if(this.value == '') { this.value = 'twitter'; }")
						- else
							input#commentTwitter.optional(style="float:right" type="text" value="twitter" onfocus="if(this.value == 'twitter') { this.value = ''; } backToOriginalBackground(this);"
							onblur="if(this.value == '') { this.value = 'twitter'; }")

					.clearboth
						
						
					textarea#commentContent(onfocus="backToOriginalBackground(this);")
					.checkbox
						input#comRemember(type="checkbox" checked)
						p #{keys.comment_remember}
					.clearboth
					.checkbox
						input#comEmailOnAnswer(type="checkbox" checked)
						p #{keys.comment_email_on_answer}
					.clearboth
					input(type="button" value="Send" onclick="postComment('name','email','website','twitter')")
				
			
				