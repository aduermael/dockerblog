version: '2'
services: 
  
  blog-db:
    build: 
      context: ./db
    container_name: blog-db
    stdin_open: true
    tty: true
    volumes:
      - blog-data:/blog-data


  redis-cli:
    image: redis:3.2.9-alpine
    container_name: blog-redis-cli
    stdin_open: true
    tty: true
    # attach then `redis-cli -h blog-db`
    command: ash


  blog-router:
    build:
      context: .
      dockerfile: router.Dockerfile
    container_name: blog-router
    ports:
      - "80:80"
    stdin_open: true
    tty: true
    # environment: # PROD
    #   - GIN_MODE=release # PROD
    volumes:
      - blog-data:/blog-data
      - ./themes/laurel/templates:/blog-data/templates # DEV
      - ./themes/laurel/static:/blog-data/static/theme # DEV

  blog-fbcomments:
    build: 
      context: ./plugins/fbcomments
    container_name: blog-fbcomments
    stdin_open: true
    tty: true


  # blog-filesystem:
  #   build: 
  #     context: ./filesystem
  #   container_name: blog-filesystem
  #   stdin_open: true
  #   tty: true
  #   volumes:
  #     - ./filesystem/src:/go/src # DEV
  #   command: ash # DEV

  # # to test
  # filesystem-client:
  #   build: 
  #     context: ./filesystem/client
  #   container_name: blog-filesystem-client
  #   stdin_open: true
  #   tty: true

  blog-legacy:
    build:
      context: ./legacy
    container_name: blog-legacy
    stdin_open: true
    tty: true
    volumes:
      - blog-data:/blog-data


volumes:
  blog-data:
    driver: local
